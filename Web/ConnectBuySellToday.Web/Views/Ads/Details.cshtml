@model ConnectBuySellToday.Application.DTOs.AdDto

@using ConnectBuySellToday.Domain.Enums
@using System.Security.Claims

@{
    ViewData["Title"] = Model.Title;
    var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
}

<div class="container">
    <div class="row">
        <div class="col-md-6">
            @if (Model.ImageUrls.Any())
            {
                <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        @for (int i = 0; i < Model.ImageUrls.Count; i++)
                        {
                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <img src="@Model.ImageUrls[i]" class="d-block w-100" alt="@Model.Title" style="height: 400px; object-fit: cover;">
                            </div>
                        }
                    </div>
                    @if (Model.ImageUrls.Count > 1)
                    {
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    }
                </div>
            }
            else if (!string.IsNullOrEmpty(Model.MainImageUrl))
            {
                <img src="@Model.MainImageUrl" class="img-fluid rounded" alt="@Model.Title" style="width: 100%;">
            }
            else
            {
                <div class="bg-secondary d-flex align-items-center justify-content-center rounded" style="height: 400px;">
                    <span class="text-white">No Image Available</span>
                </div>
            }
        </div>
        <div class="col-md-6">
            <h1>@Model.Title</h1>
            <h2 class="text-primary">$@Model.Price.ToString("N2")</h2>
            
            <div class="mb-3">
                <span class="badge bg-info">@Model.CategoryName</span>
                <span class="badge bg-@(Model.Status == AdStatus.Active ? "success" : "secondary")">
                    @Model.Status
                </span>
            </div>
            
            <div class="mb-3">
                <h5>Description</h5>
                <p>@Model.Description</p>
            </div>
            
            <div class="mb-3">
                <p class="text-muted"><small>Posted: @Model.CreatedAt.ToString("MMMM dd, yyyy HH:mm")</small></p>
                <p class="text-muted"><small>Seller ID: @Model.SellerId</small></p>
            </div>
            
            @if (User.Identity?.IsAuthenticated == true && currentUserId != Model.SellerId)
            {
                <a asp-controller="Dashboard" asp-action="Chat" asp-route-adId="@Model.Id" asp-route-otherUserId="@Model.SellerId" class="btn btn-success btn-lg">Contact Seller</a>
            }
            else if (currentUserId == Model.SellerId)
            {
                <span class="btn btn-secondary btn-lg disabled">Your Ad</span>
            }
            else
            {
                <a asp-area="Identity" asp-page="/Account/Login" asp-route-returnUrl="@Url.Action("Details", "Ads", new { id = Model.Id })" class="btn btn-success btn-lg">Login to Contact Seller</a>
            }
            <a asp-controller="Ads" asp-action="Index" class="btn btn-outline-secondary btn-lg">Back to List</a>
        </div>
    </div>
</div>
